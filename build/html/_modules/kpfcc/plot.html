

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>kpfcc.plot &mdash; AstroQ 1.0.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=8d563738"></script>
      <script src="../../_static/doctools.js?v=9a2dae69"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            AstroQ
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api.html">API</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">AstroQ</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">kpfcc.plot</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for kpfcc.plot</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Module for plotting.</span>
<span class="sd">Designed to be only run as a function call from the generateScript.py script.</span>

<span class="sd">Example usage:</span>
<span class="sd">    import plotting_functions as ptf</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">plotly.graph_objects</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">go</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">plotly.express</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">px</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">astropy.time</span><span class="w"> </span><span class="kn">import</span> <span class="n">Time</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">seaborn</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sns</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">kpfcc.io</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">io</span>

<span class="n">labelsize</span> <span class="o">=</span> <span class="mi">25</span>
<span class="n">palette</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">color_palette</span><span class="p">(</span><span class="s2">&quot;colorblind&quot;</span><span class="p">)</span>
<span class="n">named_colors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="s1">&#39;gold&#39;</span><span class="p">,</span> <span class="s1">&#39;maroon&#39;</span><span class="p">,</span> <span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="s1">&#39;magenta&#39;</span><span class="p">,</span> <span class="s1">&#39;purple&#39;</span><span class="p">]</span>
<span class="n">color_scales</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;blue&#39;</span><span class="p">:[[</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;rgba(0,0,0,0)&#39;</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;rgb(0,0,255)&#39;</span><span class="p">]],</span>
                <span class="s1">&#39;red&#39;</span><span class="p">:[[</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;rgba(0,0,0,0)&#39;</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;rgb(255,0,0)&#39;</span><span class="p">]],</span>
                <span class="s1">&#39;green&#39;</span><span class="p">:[[</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;rgba(0,0,0,0)&#39;</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;rgb(0,255,0)&#39;</span><span class="p">]],</span>
                <span class="s1">&#39;gold&#39;</span><span class="p">:[[</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;rgba(0,0,0,0)&#39;</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;rgb(255, 215, 0)&#39;</span><span class="p">]],</span>
                <span class="s1">&#39;maroon&#39;</span><span class="p">:[[</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;rgba(0,0,0,0)&#39;</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;rgb(128,0,0)&#39;</span><span class="p">]],</span>
                <span class="s1">&#39;gray&#39;</span><span class="p">:[[</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;rgba(0,0,0,0)&#39;</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;rgb(128,128,128)&#39;</span><span class="p">]],</span>
                <span class="s1">&#39;orange&#39;</span><span class="p">:[[</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;rgba(0,0,0,0)&#39;</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;rgb(255,165,0)&#39;</span><span class="p">]],</span>
                <span class="s1">&#39;magenta&#39;</span><span class="p">:[[</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;rgba(0,0,0,0)&#39;</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;rgb(255,0,255)&#39;</span><span class="p">]],</span>
                <span class="s1">&#39;purple&#39;</span><span class="p">:[[</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;rgba(0,0,0,0)&#39;</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;rgb(127,0,255)&#39;</span><span class="p">]],}</span>

<div class="viewcode-block" id="run_plot_suite">
<a class="viewcode-back" href="../../kpfcc.html#kpfcc.plot.run_plot_suite">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">run_plot_suite</span><span class="p">(</span><span class="n">star_tracker</span><span class="p">,</span> <span class="n">manager</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A one line call to kick off all the plotting/reporting routines</span>

<span class="sd">    Args:</span>
<span class="sd">        star_tracker (object): a object from the StarTracker class</span>
<span class="sd">        outputdir (str): directory to save outputs</span>
<span class="sd">        build_starmaps (boolean): if true, spend the time to build the star maps</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">all_program_cofs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">all_program_info</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">all_program_first_forecast</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="n">all_star_maps_all_programs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">all_star_colors_all_programs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">all_star_nObs_all_programs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">all_stars_in_program</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">all_stars</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">all_completions</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">prog_colors</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">p</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">star_tracker</span><span class="o">.</span><span class="n">programs</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Generating plots for Program &quot;</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
        <span class="n">prog_colors</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">=</span> <span class="n">palette</span><span class="p">[</span><span class="n">p</span><span class="o">%</span><span class="nb">len</span><span class="p">(</span><span class="n">palette</span><span class="p">)]</span>

        <span class="n">program_COF</span><span class="p">,</span> <span class="n">program_total_obs_request</span><span class="p">,</span> <span class="n">program_first_forecast</span><span class="p">,</span> <span class="n">stars_in_program</span><span class="p">,</span> \
            <span class="n">stars_completion</span> <span class="o">=</span> <span class="n">generate_single_program_plot_suite</span><span class="p">(</span><span class="n">star_tracker</span><span class="p">,</span> <span class="n">star_tracker</span><span class="o">.</span><span class="n">programs</span><span class="p">[</span><span class="n">p</span><span class="p">],</span>
                                                                <span class="n">build_cadence_plots</span><span class="o">=</span><span class="n">manager</span><span class="o">.</span><span class="n">build_starmaps</span><span class="p">)</span>
        <span class="n">all_program_cofs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">program_COF</span><span class="p">)</span>
        <span class="n">all_stars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stars_in_program</span><span class="p">)</span>
        <span class="n">all_completions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stars_completion</span><span class="p">)</span>

        <span class="n">all_program_info</span><span class="p">[</span><span class="n">star_tracker</span><span class="o">.</span><span class="n">programs</span><span class="p">[</span><span class="n">p</span><span class="p">]]</span> <span class="o">=</span> <span class="n">program_total_obs_request</span>
        <span class="n">all_program_first_forecast</span><span class="p">[</span><span class="n">star_tracker</span><span class="o">.</span><span class="n">programs</span><span class="p">[</span><span class="n">p</span><span class="p">]]</span> <span class="o">=</span> <span class="n">program_first_forecast</span>

        <span class="n">all_star_maps</span><span class="p">,</span> <span class="n">all_star_cols</span><span class="p">,</span> <span class="n">all_star_nObs</span><span class="p">,</span> <span class="n">stars_in_program</span> <span class="o">=</span> \
            <span class="n">create_single_program_birds_eye</span><span class="p">(</span><span class="n">star_tracker</span><span class="p">,</span> <span class="n">star_tracker</span><span class="o">.</span><span class="n">programs</span><span class="p">[</span><span class="n">p</span><span class="p">],</span> <span class="n">prog_colors</span><span class="p">[</span><span class="n">p</span><span class="p">])</span>
        <span class="n">all_star_maps_all_programs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">all_star_maps</span><span class="p">)</span>

        <span class="c1"># program_color = named_colors[p%len(named_colors)]</span>
        <span class="c1"># all_star_colors_all_programs += [program_color]*len(all_star_maps)</span>
        <span class="n">all_star_colors_all_programs</span> <span class="o">+=</span> <span class="p">[</span><span class="n">prog_colors</span><span class="p">[</span><span class="n">p</span><span class="p">]]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">all_star_maps</span><span class="p">)</span>
        <span class="n">all_star_nObs_all_programs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">all_star_nObs</span><span class="p">)</span>

        <span class="n">all_stars_in_program</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stars_in_program</span><span class="p">)</span>

        <span class="n">generate_birds_eye</span><span class="p">(</span><span class="n">star_tracker</span><span class="p">,</span> <span class="n">all_star_maps</span><span class="p">,</span> <span class="n">all_star_cols</span><span class="p">,</span> <span class="n">all_star_nObs</span><span class="p">,</span>
                             <span class="n">star_tracker</span><span class="o">.</span><span class="n">programs</span><span class="p">[</span><span class="n">p</span><span class="p">],</span> <span class="n">stars_in_program</span><span class="p">)</span>

    <span class="n">flat_all_star_maps_all_programs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">all_star_maps_all_programs</span><span class="p">)</span>
    <span class="n">flat_all_star_nObs_all_programs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">all_star_nObs_all_programs</span><span class="p">)</span>
    <span class="n">flat_all_stars_in_program</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">all_stars_in_program</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Generating admin view plot suite.&quot;</span><span class="p">)</span>
    <span class="n">generate_admin_view_plot_suite</span><span class="p">(</span><span class="n">star_tracker</span><span class="p">,</span> <span class="n">all_program_cofs</span><span class="p">,</span> <span class="n">all_program_info</span><span class="p">,</span>
                                       <span class="n">all_program_first_forecast</span><span class="p">,</span> <span class="n">flat_all_star_maps_all_programs</span><span class="p">,</span>
                                       <span class="n">all_star_colors_all_programs</span><span class="p">,</span>
                                       <span class="n">flat_all_star_nObs_all_programs</span><span class="p">,</span> <span class="n">flat_all_stars_in_program</span><span class="p">,</span>
                                       <span class="n">prog_colors</span><span class="p">)</span>
    <span class="n">all_stars</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">all_stars</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="n">all_completions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">all_completions</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="n">complete_frame</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;Starname&quot;</span><span class="p">:</span><span class="n">all_stars</span><span class="p">,</span> <span class="s1">&#39;CompletetionPercent&#39;</span><span class="p">:</span><span class="n">all_completions</span><span class="p">})</span>
    <span class="n">complete_frame</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">manager</span><span class="o">.</span><span class="n">semester_directory</span> <span class="o">+</span> <span class="s1">&#39;reports/admin/&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">star_tracker</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">current_day</span><span class="p">)</span> <span class="o">+</span> \
                                                    <span class="s1">&#39;/cofs/final_completion_rates.csv&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;All plots generated. Saved to &quot;</span> <span class="o">+</span> <span class="n">manager</span><span class="o">.</span><span class="n">semester_directory</span> <span class="o">+</span> <span class="s2">&quot;reports/&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="write_cadence_plot_files">
<a class="viewcode-back" href="../../kpfcc.html#kpfcc.plot.write_cadence_plot_files">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">write_cadence_plot_files</span><span class="p">(</span><span class="n">manager</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">manager</span><span class="o">.</span><span class="n">build_starmaps</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Writing cadence plot files.&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">manager</span><span class="o">.</span><span class="n">output_directory</span><span class="p">,</span> <span class="s2">&quot;raw_combined_semester_schedule_Round2.txt&quot;</span><span class="p">),</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
            <span class="n">combined_semester_schedule_stars</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">]</span>

        <span class="n">turn_on_off_frame</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">manager</span><span class="o">.</span><span class="n">turn_on_off_file</span><span class="p">)</span>
        <span class="n">all_starmaps</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">manager</span><span class="o">.</span><span class="n">requests_frame</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">manager</span><span class="o">.</span><span class="n">database_info_dict</span> <span class="o">!=</span> <span class="p">{}:</span>
                <span class="n">starmap</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">build_observed_map_past</span><span class="p">(</span> \
                    <span class="n">manager</span><span class="o">.</span><span class="n">database_info_dict</span><span class="p">[</span><span class="n">manager</span><span class="o">.</span><span class="n">requests_frame</span><span class="p">[</span><span class="s1">&#39;Starname&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]],</span> <span class="n">manager</span><span class="o">.</span><span class="n">starmap_template_filename</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">starmap</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">build_observed_map_past</span><span class="p">([[],[],[],[]],</span> <span class="n">manager</span><span class="o">.</span><span class="n">starmap_template_filename</span><span class="p">)</span>

            <span class="n">starmap_updated</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">build_observed_map_future</span><span class="p">(</span><span class="n">manager</span><span class="p">,</span> <span class="n">combined_semester_schedule_stars</span><span class="p">,</span>
                                <span class="n">manager</span><span class="o">.</span><span class="n">requests_frame</span><span class="p">[</span><span class="s1">&#39;Starname&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="n">starmap</span><span class="p">)</span>

            <span class="n">all_starmaps</span><span class="p">[</span><span class="n">manager</span><span class="o">.</span><span class="n">requests_frame</span><span class="p">[</span><span class="s1">&#39;Starname&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="n">starmap_updated</span>
            <span class="n">future_unique_days_forecasted</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">manager</span><span class="o">.</span><span class="n">combined_semester_schedule_stars</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">manager</span><span class="o">.</span><span class="n">requests_frame</span><span class="p">[</span><span class="s1">&#39;Starname&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="ow">in</span> <span class="n">manager</span><span class="o">.</span><span class="n">combined_semester_schedule_stars</span><span class="p">[</span><span class="n">k</span><span class="p">]:</span>
                    <span class="n">future_unique_days_forecasted</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">past_unique_dates_for_star</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="n">database_info_dict</span><span class="p">[</span><span class="n">manager</span><span class="o">.</span><span class="n">requests_frame</span><span class="p">[</span><span class="s1">&#39;Starname&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]][</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">past_unique_dates_for_star</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">write_one_cadence_plot_file</span><span class="p">(</span><span class="n">manager</span><span class="o">.</span><span class="n">requests_frame</span><span class="p">[</span><span class="s1">&#39;Starname&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="n">starmap_updated</span><span class="p">,</span>
                                        <span class="n">turn_on_off_frame</span><span class="p">,</span> <span class="n">manager</span><span class="o">.</span><span class="n">requests_frame</span><span class="p">,</span>
                                        <span class="n">future_unique_days_forecasted</span><span class="p">,</span>
                                        <span class="n">past_unique_dates_for_star</span><span class="p">,</span>
                                        <span class="n">manager</span><span class="o">.</span><span class="n">current_day</span><span class="p">,</span> <span class="n">manager</span><span class="o">.</span><span class="n">output_directory</span><span class="p">)</span></div>


<div class="viewcode-block" id="write_one_cadence_plot_file">
<a class="viewcode-back" href="../../kpfcc.html#kpfcc.plot.write_one_cadence_plot_file">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">write_one_cadence_plot_file</span><span class="p">(</span><span class="n">starname</span><span class="p">,</span> <span class="n">starmap</span><span class="p">,</span> <span class="n">turn_frame</span><span class="p">,</span> <span class="n">requests_frame</span><span class="p">,</span> <span class="n">future_obs</span><span class="p">,</span>
                            <span class="n">unique_hst_dates_observed</span><span class="p">,</span> <span class="n">current_day</span><span class="p">,</span> <span class="n">outputdir</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Write the file from which later we can produce the cadence plot</span>

<span class="sd">    Args:</span>
<span class="sd">        starname (int): the string of the star&#39;s name</span>
<span class="sd">        starmap (dataframe): contains information on observation history and forecast</span>
<span class="sd">        turn_frame (dataframe): contains information on the first and last day a target</span>
<span class="sd">                                 is observable in each quarter of the night. Pre-computed.</span>
<span class="sd">        requests_frame (dataframe): the information on the request strategies</span>
<span class="sd">        unique_hst_dates_observed (array): list of dates previously observed</span>
<span class="sd">        current_day (str): today&#39;s date, format YYYY-MM-DD</span>
<span class="sd">        outputdir (str): the path to the save directory</span>
<span class="sd">    Returns:</span>
<span class="sd">        None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">request_id</span> <span class="o">=</span> <span class="n">requests_frame</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">requests_frame</span><span class="p">[</span><span class="s1">&#39;Starname&#39;</span><span class="p">]</span><span class="o">==</span><span class="nb">str</span><span class="p">(</span><span class="n">starname</span><span class="p">)][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">program_code</span> <span class="o">=</span> <span class="n">requests_frame</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">request_id</span><span class="p">,</span><span class="s1">&#39;Program_Code&#39;</span><span class="p">]</span>
    <span class="n">save_path</span> <span class="o">=</span> <span class="n">outputdir</span> <span class="o">+</span> <span class="s2">&quot;/cadences/&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">program_code</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">save_path</span><span class="p">,</span> <span class="n">exist_ok</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

    <span class="n">n_obs_desired</span> <span class="o">=</span> <span class="n">requests_frame</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">request_id</span><span class="p">,</span><span class="s1">&#39;# of Nights Per Semester&#39;</span><span class="p">]</span>
    <span class="n">n_obs_taken</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">unique_hst_dates_observed</span><span class="p">)</span>
    <span class="n">n_obs_scheduled</span> <span class="o">=</span> <span class="n">future_obs</span> <span class="c1">#np.sum(starmap[&#39;N_obs&#39;]) #n_obs_desired - n_obs_taken #</span>
    <span class="n">cadence</span> <span class="o">=</span> <span class="n">requests_frame</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">request_id</span><span class="p">,</span><span class="s1">&#39;Minimum Inter-Night Cadence&#39;</span><span class="p">]</span>
    <span class="n">turn_index</span> <span class="o">=</span> <span class="n">turn_frame</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">turn_frame</span><span class="p">[</span><span class="s1">&#39;Starname&#39;</span><span class="p">]</span><span class="o">==</span><span class="nb">str</span><span class="p">(</span><span class="n">starname</span><span class="p">)][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">turns</span> <span class="o">=</span> <span class="p">[[</span><span class="n">turn_frame</span><span class="p">[</span><span class="s1">&#39;Q1_on_date&#39;</span><span class="p">][</span><span class="n">turn_index</span><span class="p">],</span> <span class="n">turn_frame</span><span class="p">[</span><span class="s1">&#39;Q1_off_date&#39;</span><span class="p">][</span><span class="n">turn_index</span><span class="p">]],</span>
             <span class="p">[</span><span class="n">turn_frame</span><span class="p">[</span><span class="s1">&#39;Q2_on_date&#39;</span><span class="p">][</span><span class="n">turn_index</span><span class="p">],</span> <span class="n">turn_frame</span><span class="p">[</span><span class="s1">&#39;Q2_off_date&#39;</span><span class="p">][</span><span class="n">turn_index</span><span class="p">]],</span>
             <span class="p">[</span><span class="n">turn_frame</span><span class="p">[</span><span class="s1">&#39;Q3_on_date&#39;</span><span class="p">][</span><span class="n">turn_index</span><span class="p">],</span> <span class="n">turn_frame</span><span class="p">[</span><span class="s1">&#39;Q3_off_date&#39;</span><span class="p">][</span><span class="n">turn_index</span><span class="p">]],</span>
             <span class="p">[</span><span class="n">turn_frame</span><span class="p">[</span><span class="s1">&#39;Q4_on_date&#39;</span><span class="p">][</span><span class="n">turn_index</span><span class="p">],</span> <span class="n">turn_frame</span><span class="p">[</span><span class="s1">&#39;Q4_off_date&#39;</span><span class="p">][</span><span class="n">turn_index</span><span class="p">]]]</span>

    <span class="n">commentsfile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">save_path</span> <span class="o">+</span> <span class="n">starname</span> <span class="o">+</span> <span class="s2">&quot;_Cadence_Interactive.csv&quot;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="n">commentsfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;#starname:&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">starname</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">commentsfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;#programcode:&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">program_code</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">commentsfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;#Nobs_scheduled:&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">n_obs_scheduled</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">commentsfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;#Nobs_desired:&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">n_obs_desired</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">commentsfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;#Nobs_taken:&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">n_obs_taken</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">commentsfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;#cadence:&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">cadence</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">commentsfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;#q1_start:&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">turns</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">commentsfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;#q1_end:&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">turns</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">commentsfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;#q2_start:&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">turns</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">commentsfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;#q2_end:&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">turns</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">commentsfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;#q3_start:&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">turns</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">commentsfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;#q3_end:&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">turns</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">commentsfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;#q4_start:&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">turns</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">commentsfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;#q4_end:&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">turns</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">commentsfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;#current_day:&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">current_day</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">starmap</span> <span class="o">=</span> <span class="n">starmap</span><span class="p">[</span><span class="n">starmap</span><span class="o">.</span><span class="n">Allocated</span> <span class="o">==</span> <span class="kc">True</span><span class="p">]</span>
    <span class="n">starmap</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">commentsfile</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">commentsfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>


<div class="viewcode-block" id="single_request_cof">
<a class="viewcode-back" href="../../kpfcc.html#kpfcc.plot.single_request_cof">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">single_request_cof</span><span class="p">(</span><span class="n">star_tracker</span><span class="p">,</span> <span class="n">star</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute cumulative observation function for a single request</span>

<span class="sd">    Args:</span>
<span class="sd">        star_tracker (object): a object from the StarTracker class</span>
<span class="sd">        star (str): the name of the star in question</span>

<span class="sd">    Returns:</span>
<span class="sd">        running_total_obs_counter (array): of length semester_length, the running number of</span>
<span class="sd">                                           observations over the course of the semester</span>
<span class="sd">        running_total_obs_percent (array): of length semester_length, the running percent of</span>
<span class="sd">                                           request completion over the course of the semester</span>
<span class="sd">        total_observations_requested (int): the number of exposure to complete the request</span>
<span class="sd">        first_forecast (dataframe): contains information on the first forecast of the target</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">requested_nobs_per_night</span><span class="p">,</span> <span class="n">total_observations_requested</span><span class="p">,</span> <span class="n">exposure_time</span><span class="p">,</span> <span class="n">slots_per_night</span><span class="p">,</span> \
                 <span class="n">program</span><span class="p">,</span> <span class="n">slots_per_visit</span> <span class="o">=</span> <span class="n">star_tracker</span><span class="o">.</span><span class="n">get_star_stats</span><span class="p">(</span><span class="n">star</span><span class="p">)</span>

    <span class="c1"># to add an absolute time accounting COF, need:</span>
    <span class="c1"># parse past open shutter time + overhead per night</span>
    <span class="c1"># define expected time (incl. overhead) per night</span>
    <span class="c1"># define total time ask for request</span>
    <span class="n">first_forecast</span> <span class="o">=</span> <span class="n">star_tracker</span><span class="o">.</span><span class="n">get_star_first_forecast</span><span class="p">(</span><span class="n">program</span><span class="p">,</span> <span class="n">star</span><span class="p">)</span>

    <span class="n">observations_past</span> <span class="o">=</span> <span class="n">star_tracker</span><span class="o">.</span><span class="n">get_star_past</span><span class="p">(</span><span class="n">star</span><span class="p">)</span>
    <span class="n">observations_future</span> <span class="o">=</span> <span class="n">star_tracker</span><span class="o">.</span><span class="n">get_star_forecast</span><span class="p">(</span><span class="n">star</span><span class="p">)</span>
    <span class="n">running_total_obs_counter</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">running_total_obs_percent</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">star_tracker</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">all_dates_array</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">star_tracker</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">all_dates_array</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">observations_past</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">counter</span> <span class="o">+=</span> <span class="n">observations_past</span><span class="p">[</span><span class="n">star_tracker</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">all_dates_array</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
        <span class="k">if</span> <span class="n">star_tracker</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">all_dates_array</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">observations_future</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">counter</span> <span class="o">+=</span> <span class="n">observations_future</span><span class="p">[</span><span class="n">star_tracker</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">all_dates_array</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
        <span class="n">running_total_obs_counter</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">counter</span><span class="p">)</span>
        <span class="n">running_total_obs_percent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">((</span><span class="n">counter</span><span class="o">/</span><span class="n">total_observations_requested</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">running_total_obs_counter</span><span class="p">,</span> <span class="n">running_total_obs_percent</span><span class="p">,</span> <span class="n">total_observations_requested</span><span class="p">,</span> \
            <span class="n">first_forecast</span></div>


<div class="viewcode-block" id="programmatic_cof">
<a class="viewcode-back" href="../../kpfcc.html#kpfcc.plot.programmatic_cof">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">programmatic_cof</span><span class="p">(</span><span class="n">star_tracker</span><span class="p">,</span> <span class="n">list_of_request_cofs</span><span class="p">,</span> <span class="n">total_program_observations</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Build the cumulative obesrvation function for a group of requests</span>

<span class="sd">    Args:</span>
<span class="sd">        star_tracker (object): a object from the StarTracker class</span>
<span class="sd">        list_of_request_cofs (array): an array of COF arrays</span>
<span class="sd">        total_program_observations (int): sum of all exposures for the set of requests</span>

<span class="sd">    Returns:</span>
<span class="sd">        program_cof_counter (array): of length semester_length, the running number of</span>
<span class="sd">                                      observations over the course of the semester</span>
<span class="sd">        program_cof_percent (array): of length semester_length, the running percent of</span>
<span class="sd">                                     request completion over the course of the semester</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">program_cof_counter</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">program_cof_percent</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">all_counter</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">star_tracker</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">all_dates_array</span><span class="p">)):</span>
        <span class="n">day_counter</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">list_of_request_cofs</span><span class="p">)):</span>
            <span class="n">day_counter</span> <span class="o">+=</span> <span class="n">list_of_request_cofs</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
        <span class="n">all_counter</span> <span class="o">+=</span> <span class="n">day_counter</span>
        <span class="n">program_cof_counter</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">day_counter</span><span class="p">)</span>
        <span class="n">program_cof_percent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">((</span><span class="n">day_counter</span><span class="o">/</span><span class="n">total_program_observations</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">program_cof_counter</span><span class="p">,</span> <span class="n">program_cof_percent</span></div>


<div class="viewcode-block" id="build_multi_request_cof">
<a class="viewcode-back" href="../../kpfcc.html#kpfcc.plot.build_multi_request_cof">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">build_multi_request_cof</span><span class="p">(</span><span class="n">star_tracker</span><span class="p">,</span> <span class="n">all_cofs_array</span><span class="p">,</span> <span class="n">star_info</span><span class="p">,</span> <span class="n">all_first_forecasts</span><span class="p">,</span>
                            <span class="n">even_burn_rate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">flag</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">color_palette</span><span class="o">=</span><span class="p">{}):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Build the COF plot</span>

<span class="sd">    Args:</span>
<span class="sd">        star_tracker (object): a object from the StarTracker class</span>
<span class="sd">        all_cofs_array (array): an array of COF arrays</span>
<span class="sd">        star_info (dict): keys are the star names, values are</span>
<span class="sd">        all_first_forecasts (array): array of the first forecast arrays for each star in set</span>
<span class="sd">        even_burn_rate (boolean): if True, show an even burn rate line</span>
<span class="sd">        flag (boolean): if True, the plot is only for the admin view</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">flag</span> <span class="ow">and</span> <span class="n">color_palette</span> <span class="o">==</span> <span class="p">{}:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Must input a color_palette value when flag==True.&quot;</span><span class="p">)</span>

    <span class="n">starnames</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">star_info</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">even_burn_rate</span><span class="p">:</span>
        <span class="n">burn_line</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">star_tracker</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">all_dates_array</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">burn_line</span><span class="p">)):</span>
            <span class="n">burn_line</span><span class="p">[</span><span class="n">b</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">burn_line</span><span class="p">[</span><span class="n">b</span><span class="p">],</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="n">star_tracker</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">all_dates_array</span><span class="p">,</span>
            <span class="n">y</span><span class="o">=</span><span class="n">burn_line</span><span class="p">,</span>
            <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;lines&#39;</span><span class="p">,</span>
            <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">dash</span><span class="o">=</span><span class="s1">&#39;dash&#39;</span><span class="p">),</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Even Burn Rate&quot;</span><span class="p">,</span>
            <span class="n">hovertemplate</span><span class="o">=</span> <span class="s1">&#39;Date: %</span><span class="si">{x}</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="s1">&#39;&lt;br&gt;% Complete: %</span><span class="si">{y}</span><span class="s1">&#39;</span>
        <span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">y_values</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">all_cofs_array</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">flag</span><span class="p">:</span>
            <span class="n">color_line</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;rgb(</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">color_palette</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">255</span><span class="p">)</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">color_palette</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="mi">255</span><span class="p">)</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">color_palette</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="mi">255</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">color_line</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">named_colors</span><span class="p">)</span>
        <span class="n">star</span> <span class="o">=</span> <span class="n">starnames</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">star</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">y_values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="mi">2</span><span class="p">)))</span>
        <span class="n">label</span> <span class="o">=</span> <span class="n">star_info</span><span class="p">[</span><span class="n">star</span><span class="p">]</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="n">star_tracker</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">all_dates_array</span><span class="p">,</span>
            <span class="n">y</span><span class="o">=</span><span class="n">y_values</span><span class="p">,</span>
            <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;lines&#39;</span><span class="p">,</span>
            <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">color_line</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span>
            <span class="n">name</span><span class="o">=</span><span class="n">star</span><span class="p">,</span>
            <span class="n">hovertemplate</span><span class="o">=</span> <span class="s1">&#39;Date: %</span><span class="si">{x}</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="s1">&#39;&lt;br&gt;% Complete: %</span><span class="si">{y}</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="s1">&#39;&lt;br&gt;# Obs Requested: &#39;</span> <span class="o">+</span> \
                <span class="nb">str</span><span class="p">(</span><span class="n">label</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;&lt;br&gt;&#39;</span>
        <span class="p">))</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
                <span class="n">x</span><span class="o">=</span><span class="n">star_tracker</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">all_dates_array</span><span class="p">,</span>
                <span class="n">y</span><span class="o">=</span><span class="n">all_first_forecasts</span><span class="p">[</span><span class="n">star</span><span class="p">][</span><span class="s1">&#39;pct_complete&#39;</span><span class="p">],</span>
                <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;lines&#39;</span><span class="p">,</span>
                <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">color_line</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">dash</span><span class="o">=</span><span class="s1">&#39;dash&#39;</span><span class="p">),</span>
                <span class="n">name</span><span class="o">=</span><span class="n">star</span> <span class="o">+</span> <span class="s2">&quot;_First_Forecast&quot;</span><span class="p">,</span>
                <span class="n">hovertemplate</span><span class="o">=</span> <span class="s1">&#39;Date: %</span><span class="si">{x}</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="s1">&#39;&lt;br&gt;% Complete: %</span><span class="si">{y}</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="s1">&#39;&lt;br&gt;# Obs Requested: &#39;</span> <span class="o">+</span> \
                    <span class="nb">str</span><span class="p">(</span><span class="n">label</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;&lt;br&gt;&#39;</span>
            <span class="p">))</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">continue</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_vrect</span><span class="p">(</span>
            <span class="n">x0</span><span class="o">=</span><span class="n">star_tracker</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">current_day</span><span class="p">,</span>
            <span class="n">x1</span><span class="o">=</span><span class="n">star_tracker</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">current_day</span><span class="p">,</span>
            <span class="n">annotation_text</span><span class="o">=</span><span class="s2">&quot;Today&quot;</span><span class="p">,</span>
            <span class="n">line_dash</span><span class="o">=</span><span class="s2">&quot;dash&quot;</span><span class="p">,</span>
            <span class="n">fillcolor</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">line_width</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
            <span class="n">line_color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
            <span class="n">annotation_position</span><span class="o">=</span><span class="s2">&quot;bottom left&quot;</span>
        <span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Cumulative Observation Function (COF)&quot;</span><span class="p">,</span>
        <span class="n">xaxis_title</span><span class="o">=</span><span class="s2">&quot;Calendar Date&quot;</span><span class="p">,</span>
        <span class="n">yaxis_title</span><span class="o">=</span><span class="s2">&quot;Request % Complete&quot;</span><span class="p">,</span>
        <span class="n">showlegend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">xaxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
            <span class="n">title_font</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">labelsize</span><span class="p">),</span>
            <span class="n">tickfont</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">labelsize</span><span class="o">-</span><span class="mi">4</span><span class="p">)</span>
        <span class="p">),</span>
        <span class="n">yaxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
            <span class="n">title_font</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">labelsize</span><span class="p">),</span>
            <span class="n">tickfont</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">labelsize</span><span class="o">-</span><span class="mi">4</span><span class="p">)</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">admin_path</span> <span class="o">=</span> <span class="n">star_tracker</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">reports_directory</span> <span class="o">+</span> <span class="s2">&quot;admin/&quot;</span> <span class="o">+</span> <span class="n">star_tracker</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">current_day</span> <span class="o">+</span> <span class="s2">&quot;/cofs/&quot;</span>
    <span class="k">if</span> <span class="n">flag</span><span class="p">:</span>
        <span class="n">fileout_path</span> <span class="o">=</span> <span class="n">admin_path</span>
        <span class="n">fileout_name</span> <span class="o">=</span> <span class="s1">&#39;all_programs_pct_by_program.html&#39;</span>
        <span class="n">fileout_name_report</span> <span class="o">=</span> <span class="s1">&#39;all_programs_pct_by_program_report.txt&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fileout_path</span> <span class="o">=</span> <span class="n">star_tracker</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">reports_directory</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">star_info</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> \
            <span class="n">star_tracker</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">current_day</span> <span class="o">+</span> <span class="s2">&quot;/cofs/&quot;</span>
        <span class="n">fileout_name</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">star_info</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;_COF_pct_by_star.html&#39;</span>
        <span class="n">fileout_name_report</span> <span class="o">=</span>  <span class="nb">list</span><span class="p">(</span><span class="n">star_info</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;_completion_Report.txt&quot;</span>
        <span class="c1"># write copy to admin folder</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">write_html</span><span class="p">(</span><span class="n">admin_path</span> <span class="o">+</span> <span class="n">fileout_name</span><span class="p">)</span>
        <span class="n">file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">admin_path</span> <span class="o">+</span> <span class="n">fileout_name_report</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
            <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">l</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">write_html</span><span class="p">(</span><span class="n">fileout_path</span> <span class="o">+</span> <span class="n">fileout_name</span><span class="p">)</span>
    <span class="n">file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">fileout_path</span> <span class="o">+</span> <span class="s2">&quot;completion_Report.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
        <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">l</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>



<div class="viewcode-block" id="generate_cadence_view_plot">
<a class="viewcode-back" href="../../kpfcc.html#kpfcc.plot.generate_cadence_view_plot">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">generate_cadence_view_plot</span><span class="p">(</span><span class="n">star_tracker</span><span class="p">,</span> <span class="n">program</span><span class="p">,</span> <span class="n">star</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Build cadence overview plot</span>

<span class="sd">    Args:</span>
<span class="sd">        program (str): the program code</span>
<span class="sd">        starname (str): the name of the star in question</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Read the file and process data to generate the plot</span>
    <span class="c1"># Example: Read data from filename and generate a scatter plot</span>
    <span class="c1"># Replace this with your actual data processing code</span>
    <span class="c1"># For this example, we&#39;ll generate a dummy scatter plot</span>
    <span class="c1"># files should always have the following format (with {} indicating values):</span>
    <span class="c1"># line1 --- &quot;starname:{string}&quot;</span>
    <span class="c1"># line2 --- &quot;programcode:{string}&quot;</span>
    <span class="c1"># line3 --- &quot;Nobs_scheduled:{int}&quot;</span>
    <span class="c1"># line4 --- &quot;Nobs_desired:{int}&quot;</span>
    <span class="c1"># line5 --- &quot;Nobs_taken:{int}&quot;</span>
    <span class="c1"># line6 --- &quot;cadence:{int}&quot;</span>
    <span class="c1"># line7 --- &quot;q1_start:{string}&quot;</span>
    <span class="c1"># line8 --- &quot;q1_end:{string}&quot;</span>
    <span class="c1"># line9 --- &quot;q2_start:{string}&quot;</span>
    <span class="c1"># line10 --- &quot;q1_end:{string}&quot;</span>
    <span class="c1"># line11 --- &quot;q3_start:{string}&quot;</span>
    <span class="c1"># line12 --- &quot;q3_end:{string}&quot;</span>
    <span class="c1"># line13 --- &quot;q4_start:{string}&quot;</span>
    <span class="c1"># line14 --- &quot;q4_end:{string}&quot;</span>
    <span class="c1"># line15 --- &quot;current_day:{string}&quot;</span>
    <span class="c1"># then a csv with columns: [&#39;Date&#39;, &#39;Observed&#39;, &#39;Quarter&#39;, &#39;Weathered&#39;, &#39;&#39;]</span>
    <span class="n">file_in</span> <span class="o">=</span> <span class="n">star_tracker</span><span class="o">.</span><span class="n">cadence_files_dir</span> <span class="o">+</span> <span class="n">program</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">star</span> <span class="o">+</span> <span class="s2">&quot;_Cadence_Interactive.csv&quot;</span>
    <span class="n">data_fig</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file_in</span><span class="p">,</span> <span class="n">comment</span><span class="o">=</span><span class="s1">&#39;#&#39;</span><span class="p">)</span>
    <span class="n">parameter_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">with</span>  <span class="nb">open</span><span class="p">(</span><span class="n">file_in</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">cmt_file</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">cmt_file</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;#&#39;</span><span class="p">:</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
                <span class="n">para</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">para</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">parameter_dict</span><span class="p">[</span> <span class="n">para</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()]</span> <span class="o">=</span> <span class="n">para</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

    <span class="c1"># use data file to determine which unique nights got observed, for &quot;6th&quot; quarter row up top</span>
    <span class="n">observed_this_night</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">holders</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">dates_on_sky</span> <span class="o">=</span> <span class="n">data_fig</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dates_on_sky</span><span class="p">)):</span>
        <span class="n">today</span> <span class="o">=</span> <span class="n">data_fig</span><span class="p">[</span><span class="n">data_fig</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">dates_on_sky</span><span class="p">[</span><span class="n">d</span><span class="p">]]</span>
        <span class="n">summation</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">today</span><span class="p">[</span><span class="s1">&#39;Observed&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">summation</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">observed_this_night</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">observed_this_night</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">holders</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">5.5</span><span class="p">)</span>
    <span class="n">sumholder</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">observed_this_night</span><span class="p">)]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">dates_on_sky</span><span class="p">)</span>
    <span class="n">outs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;Dates&#39;</span><span class="p">:</span><span class="n">dates_on_sky</span><span class="p">,</span> <span class="s2">&quot;Gotten&quot;</span><span class="p">:</span><span class="n">observed_this_night</span><span class="p">,</span> <span class="s2">&quot;Holders&quot;</span><span class="p">:</span><span class="n">holders</span><span class="p">,</span> \
                            <span class="s2">&quot;SumHolder&quot;</span><span class="p">:</span><span class="n">sumholder</span><span class="p">})</span>

    <span class="c1"># plot the dots of the data</span>
    <span class="c1"># for some reason if the first element is &quot;True&quot;, then the &quot;True&quot; values are plotted in the</span>
    <span class="c1"># color of the first color of the list</span>
    <span class="c1"># So I just check if this is satisfied and if so, swap the order of the colors</span>
    <span class="k">if</span> <span class="n">data_fig</span><span class="p">[</span><span class="s1">&#39;Observed&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">data_fig</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s2">&quot;Date&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;Quarter&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;Observed&#39;</span><span class="p">,</span>
            <span class="n">color_discrete_sequence</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="s2">&quot;black&quot;</span><span class="p">],</span> <span class="n">hover_data</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;N_obs&quot;</span><span class="p">],</span>
            <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Cadence Plot for &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">parameter_dict</span><span class="p">[</span><span class="s1">&#39;starname&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39; in Program &#39;</span> <span class="o">+</span> \
            <span class="nb">str</span><span class="p">(</span><span class="n">parameter_dict</span><span class="p">[</span><span class="s1">&#39;programcode&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;, scheduled for &quot;</span> <span class="o">+</span> \
            <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">parameter_dict</span><span class="p">[</span><span class="s1">&#39;Nobs_scheduled&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">parameter_dict</span><span class="p">[</span><span class="s1">&#39;Nobs_taken&#39;</span><span class="p">]))</span> <span class="o">+</span> \
                    <span class="s2">&quot; obs out of &quot;</span> <span class="o">+</span> \
            <span class="nb">str</span><span class="p">(</span><span class="n">parameter_dict</span><span class="p">[</span><span class="s1">&#39;Nobs_desired&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot; requested (&quot;</span> <span class="o">+</span> \
            <span class="nb">str</span><span class="p">(</span><span class="n">parameter_dict</span><span class="p">[</span><span class="s1">&#39;Nobs_taken&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot; already taken), at &quot;</span> <span class="o">+</span> \
            <span class="nb">str</span><span class="p">(</span><span class="n">parameter_dict</span><span class="p">[</span><span class="s1">&#39;cadence&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot; day cadence.&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">data_fig</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s2">&quot;Date&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;Quarter&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;Observed&#39;</span><span class="p">,</span>
            <span class="n">color_discrete_sequence</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="s2">&quot;red&quot;</span><span class="p">],</span> <span class="n">hover_data</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;N_obs&quot;</span><span class="p">],</span>
            <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Cadence Plot for &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">parameter_dict</span><span class="p">[</span><span class="s1">&#39;starname&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39; in Program &#39;</span> <span class="o">+</span> \
            <span class="nb">str</span><span class="p">(</span><span class="n">parameter_dict</span><span class="p">[</span><span class="s1">&#39;programcode&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;, scheduled for &quot;</span> <span class="o">+</span> \
            <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">parameter_dict</span><span class="p">[</span><span class="s1">&#39;Nobs_scheduled&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">parameter_dict</span><span class="p">[</span><span class="s1">&#39;Nobs_taken&#39;</span><span class="p">]))</span> <span class="o">+</span> \
                    <span class="s2">&quot; obs out of &quot;</span> <span class="o">+</span> \
            <span class="nb">str</span><span class="p">(</span><span class="n">parameter_dict</span><span class="p">[</span><span class="s1">&#39;Nobs_desired&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot; requested (&quot;</span> <span class="o">+</span> \
            <span class="nb">str</span><span class="p">(</span><span class="n">parameter_dict</span><span class="p">[</span><span class="s1">&#39;Nobs_taken&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot; already taken), at &quot;</span> <span class="o">+</span> \
            <span class="nb">str</span><span class="p">(</span><span class="n">parameter_dict</span><span class="p">[</span><span class="s1">&#39;cadence&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot; day cadence.&quot;</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_traces</span><span class="p">(</span><span class="n">marker</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">})</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">yaxis</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">tickmode</span> <span class="o">=</span> <span class="s1">&#39;linear&#39;</span><span class="p">,</span><span class="n">tick0</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">dtick</span> <span class="o">=</span> <span class="mi">1</span><span class="p">))</span>

    <span class="c1"># plot the lines atop the dots</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data_fig</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">data_fig</span><span class="p">[</span><span class="s1">&#39;Observed&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]:</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">add_shape</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s2">&quot;line&quot;</span><span class="p">,</span> <span class="n">x0</span><span class="o">=</span><span class="n">data_fig</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="n">x1</span><span class="o">=</span><span class="n">data_fig</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">],</span>
                            <span class="n">y0</span><span class="o">=</span><span class="n">data_fig</span><span class="p">[</span><span class="s1">&#39;Quarter&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">y1</span><span class="o">=</span><span class="n">data_fig</span><span class="p">[</span><span class="s1">&#39;Quarter&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">+</span><span class="mf">0.5</span><span class="p">,</span>
                            <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mi">3</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">add_shape</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s2">&quot;line&quot;</span><span class="p">,</span> <span class="n">x0</span><span class="o">=</span><span class="n">data_fig</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="n">x1</span><span class="o">=</span><span class="n">data_fig</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">],</span>
                            <span class="n">y0</span><span class="o">=</span><span class="n">data_fig</span><span class="p">[</span><span class="s1">&#39;Quarter&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">y1</span><span class="o">=</span><span class="n">data_fig</span><span class="p">[</span><span class="s1">&#39;Quarter&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">+</span><span class="mf">0.5</span><span class="p">,</span>
                            <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mi">3</span><span class="p">))</span>

    <span class="n">shown</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data_fig</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">data_fig</span><span class="p">[</span><span class="s1">&#39;Weathered&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">shown</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                <span class="n">fig</span><span class="o">.</span><span class="n">add_shape</span><span class="p">(</span><span class="n">showlegend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;line&quot;</span><span class="p">,</span> <span class="n">x0</span><span class="o">=</span><span class="n">data_fig</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">],</span>
                    <span class="n">x1</span><span class="o">=</span><span class="n">data_fig</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">],</span> <span class="n">y0</span><span class="o">=</span><span class="n">data_fig</span><span class="p">[</span><span class="s1">&#39;Quarter&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">]</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span>
                    <span class="n">y1</span><span class="o">=</span><span class="n">data_fig</span><span class="p">[</span><span class="s1">&#39;Quarter&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">]</span><span class="o">+</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;yellow&quot;</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span>
                    <span class="n">label</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s2">&quot;Weathered&quot;</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;yellow&quot;</span><span class="p">)))</span>
                <span class="n">shown</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fig</span><span class="o">.</span><span class="n">add_shape</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s2">&quot;line&quot;</span><span class="p">,</span> <span class="n">x0</span><span class="o">=</span><span class="n">data_fig</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">],</span>
                    <span class="n">x1</span><span class="o">=</span><span class="n">data_fig</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">],</span> <span class="n">y0</span><span class="o">=</span><span class="n">data_fig</span><span class="p">[</span><span class="s1">&#39;Quarter&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">]</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span>
                    <span class="n">y1</span><span class="o">=</span><span class="n">data_fig</span><span class="p">[</span><span class="s1">&#39;Quarter&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">]</span><span class="o">+</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;yellow&quot;</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mi">3</span><span class="p">))</span>

    <span class="c1"># plot the &quot;6th&quot; quarter row</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">outs</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">outs</span><span class="p">[</span><span class="s1">&#39;Gotten&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]:</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">add_shape</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s2">&quot;line&quot;</span><span class="p">,</span> <span class="n">x0</span><span class="o">=</span><span class="n">outs</span><span class="p">[</span><span class="s1">&#39;Dates&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="n">x1</span><span class="o">=</span><span class="n">outs</span><span class="p">[</span><span class="s1">&#39;Dates&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">],</span>
                <span class="n">y0</span><span class="o">=</span><span class="n">outs</span><span class="p">[</span><span class="s1">&#39;Holders&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">y1</span><span class="o">=</span><span class="n">outs</span><span class="p">[</span><span class="s1">&#39;Holders&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">+</span><span class="mf">0.5</span><span class="p">,</span>
                <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mi">3</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">add_shape</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s2">&quot;line&quot;</span><span class="p">,</span> <span class="n">x0</span><span class="o">=</span><span class="n">outs</span><span class="p">[</span><span class="s1">&#39;Dates&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="n">x1</span><span class="o">=</span><span class="n">outs</span><span class="p">[</span><span class="s1">&#39;Dates&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">],</span>
                <span class="n">y0</span><span class="o">=</span><span class="n">outs</span><span class="p">[</span><span class="s1">&#39;Holders&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">y1</span><span class="o">=</span><span class="n">outs</span><span class="p">[</span><span class="s1">&#39;Holders&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">+</span><span class="mf">0.5</span><span class="p">,</span>
                <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mi">3</span><span class="p">))</span>

    <span class="c1"># Add the green boxes of accessibility</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_shape</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s2">&quot;rect&quot;</span><span class="p">,</span> <span class="n">x0</span><span class="o">=</span><span class="n">parameter_dict</span><span class="p">[</span><span class="s1">&#39;q1_start&#39;</span><span class="p">],</span> <span class="n">x1</span><span class="o">=</span><span class="n">parameter_dict</span><span class="p">[</span><span class="s1">&#39;q1_end&#39;</span><span class="p">],</span>
        <span class="n">y0</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">y1</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">fillcolor</span><span class="o">=</span><span class="s1">&#39;lime&#39;</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">showlegend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Yes&#39;</span><span class="p">,</span>
        <span class="n">legendgrouptitle</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s1">&#39;Observable&#39;</span><span class="p">))</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_shape</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s2">&quot;rect&quot;</span><span class="p">,</span> <span class="n">x0</span><span class="o">=</span><span class="n">parameter_dict</span><span class="p">[</span><span class="s1">&#39;q2_start&#39;</span><span class="p">],</span> <span class="n">x1</span><span class="o">=</span><span class="n">parameter_dict</span><span class="p">[</span><span class="s1">&#39;q2_end&#39;</span><span class="p">],</span>
        <span class="n">y0</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">y1</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">fillcolor</span><span class="o">=</span><span class="s1">&#39;lime&#39;</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_shape</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s2">&quot;rect&quot;</span><span class="p">,</span> <span class="n">x0</span><span class="o">=</span><span class="n">parameter_dict</span><span class="p">[</span><span class="s1">&#39;q3_start&#39;</span><span class="p">],</span> <span class="n">x1</span><span class="o">=</span><span class="n">parameter_dict</span><span class="p">[</span><span class="s1">&#39;q3_end&#39;</span><span class="p">],</span>
        <span class="n">y0</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">y1</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">fillcolor</span><span class="o">=</span><span class="s1">&#39;lime&#39;</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_shape</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s2">&quot;rect&quot;</span><span class="p">,</span> <span class="n">x0</span><span class="o">=</span><span class="n">parameter_dict</span><span class="p">[</span><span class="s1">&#39;q4_start&#39;</span><span class="p">],</span> <span class="n">x1</span><span class="o">=</span><span class="n">parameter_dict</span><span class="p">[</span><span class="s1">&#39;q4_end&#39;</span><span class="p">],</span> <span class="n">y0</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
        <span class="n">y1</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">fillcolor</span><span class="o">=</span><span class="s1">&#39;lime&#39;</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

    <span class="c1"># Add the dashed line for current day</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_vline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">parameter_dict</span><span class="p">[</span><span class="s1">&#39;current_day&#39;</span><span class="p">],</span> <span class="n">line_dash</span><span class="o">=</span><span class="s1">&#39;dash&#39;</span><span class="p">,</span>
        <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mi">1</span><span class="p">,))</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_annotation</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">parameter_dict</span><span class="p">[</span><span class="s1">&#39;current_day&#39;</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s2">&quot;Today&quot;</span><span class="p">,</span>
        <span class="n">showarrow</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">yshift</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

    <span class="n">admin_path</span> <span class="o">=</span> <span class="n">star_tracker</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">reports_directory</span> <span class="o">+</span> <span class="s2">&quot;admin/&quot;</span> <span class="o">+</span> <span class="n">star_tracker</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">current_day</span> <span class="o">+</span> <span class="s2">&quot;/cadences/&quot;</span>
    <span class="n">program_path</span> <span class="o">=</span> <span class="n">star_tracker</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">reports_directory</span> <span class="o">+</span> <span class="n">program</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">star_tracker</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">current_day</span> <span class="o">+</span> <span class="s2">&quot;/cadences/&quot;</span>
    <span class="n">fileout_name</span> <span class="o">=</span> <span class="n">star</span> <span class="o">+</span> <span class="s1">&#39;_cadence_overview.html&#39;</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">write_html</span><span class="p">(</span><span class="n">admin_path</span> <span class="o">+</span> <span class="n">fileout_name</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">write_html</span><span class="p">(</span><span class="n">program_path</span> <span class="o">+</span> <span class="n">fileout_name</span><span class="p">)</span></div>


<div class="viewcode-block" id="process_single_target_for_birds_eye">
<a class="viewcode-back" href="../../kpfcc.html#kpfcc.plot.process_single_target_for_birds_eye">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">process_single_target_for_birds_eye</span><span class="p">(</span><span class="n">star_tracker</span><span class="p">,</span> <span class="n">starname</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Collect the data for a birds eye view plot</span>

<span class="sd">    Args:</span>
<span class="sd">        star_tracker (object): a object from the StarTracker class</span>
<span class="sd">        starname (str): the name of the star in question</span>

<span class="sd">    Returns:</span>
<span class="sd">        starmap (array): n_nights_in_semester by n_slots_in_night, 1 when target is scheduled</span>
<span class="sd">        nobs (int): the sum of all future observations</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">schedule_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">star_tracker</span><span class="o">.</span><span class="n">forecast</span><span class="p">)</span>
    <span class="n">consolidate</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">schedule_array</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">schedule_array</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;Past&#39;</span><span class="p">:</span>
            <span class="n">consolidate</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">schedule_array</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
    <span class="n">star_tracker</span><span class="o">.</span><span class="n">forecast_no_Past</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">consolidate</span><span class="p">)</span>
    <span class="n">starmap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">star_tracker</span><span class="o">.</span><span class="n">forecast_no_Past</span><span class="p">))</span>
    <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">star_tracker</span><span class="o">.</span><span class="n">forecast_no_Past</span> <span class="o">==</span> <span class="n">starname</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">indices</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">indices</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">indices</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">coords</span><span class="p">)):</span>
            <span class="n">starmap</span><span class="p">[</span><span class="n">coords</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">coords</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">nobs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">starmap</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">starmap</span><span class="p">,</span> <span class="n">nobs</span></div>


<div class="viewcode-block" id="create_single_program_birds_eye">
<a class="viewcode-back" href="../../kpfcc.html#kpfcc.plot.create_single_program_birds_eye">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">create_single_program_birds_eye</span><span class="p">(</span><span class="n">star_tracker</span><span class="p">,</span> <span class="n">program</span><span class="p">,</span> <span class="n">color</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Prepare data for a birds eye view plot of one program&#39;s requests</span>

<span class="sd">    Args:</span>
<span class="sd">        star_tracker (object): a object from the StarTracker class</span>
<span class="sd">        program (str): the program code</span>
<span class="sd">        color (object): seaborn color palette value for this program</span>

<span class="sd">    Returns:</span>
<span class="sd">        all_star_maps (array): all of the starmaps of requests in the program</span>
<span class="sd">        all_star_cols (array): the colors to plot each request on the birds eye</span>
<span class="sd">        all_star_nobs (array): the number of observations in each scheduled window</span>
<span class="sd">        stars_in_program (array): the list of the stars within the program</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">all_star_maps</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">all_star_cols</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">all_star_nobs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">stars_in_program</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">color_counter</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">star_tracker</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">requests_frame</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">star_tracker</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">requests_frame</span><span class="p">[</span><span class="s1">&#39;Program_Code&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">program</span><span class="p">:</span>
            <span class="n">starname</span> <span class="o">=</span> <span class="n">star_tracker</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">requests_frame</span><span class="p">[</span><span class="s1">&#39;Starname&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
            <span class="n">stars_in_program</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">starname</span><span class="p">)</span>
            <span class="n">requested_nobs_per_night</span><span class="p">,</span> <span class="n">total_observations_requested</span><span class="p">,</span> <span class="n">exposure_time</span><span class="p">,</span> <span class="n">slots_per_night</span><span class="p">,</span>\
                <span class="n">program</span><span class="p">,</span> <span class="n">slots_per_visit</span> <span class="o">=</span> <span class="n">star_tracker</span><span class="o">.</span><span class="n">get_star_stats</span><span class="p">(</span><span class="n">starname</span><span class="p">)</span>
            <span class="n">starmap</span><span class="p">,</span> <span class="n">nobs</span> <span class="o">=</span> <span class="n">process_single_target_for_birds_eye</span><span class="p">(</span><span class="n">star_tracker</span><span class="p">,</span> <span class="n">starname</span><span class="p">)</span>
            <span class="n">all_star_maps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">starmap</span><span class="p">)</span>
            <span class="n">all_star_cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
            <span class="c1"># all_star_cols.append(named_colors[color_counter%len(named_colors)])</span>
            <span class="n">all_star_nobs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nobs</span><span class="o">/</span><span class="n">slots_per_night</span><span class="p">)</span>
            <span class="n">color_counter</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">return</span> <span class="n">all_star_maps</span><span class="p">,</span> <span class="n">all_star_cols</span><span class="p">,</span> <span class="n">all_star_nobs</span><span class="p">,</span> <span class="n">stars_in_program</span></div>


<div class="viewcode-block" id="generate_birds_eye">
<a class="viewcode-back" href="../../kpfcc.html#kpfcc.plot.generate_birds_eye">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">generate_birds_eye</span><span class="p">(</span><span class="n">star_tracker</span><span class="p">,</span> <span class="n">all_star_maps</span><span class="p">,</span> <span class="n">all_star_cols</span><span class="p">,</span> <span class="n">all_star_nobs</span><span class="p">,</span> <span class="n">program</span><span class="p">,</span>
                    <span class="n">stars_in_program</span><span class="p">,</span> <span class="n">nonqueue</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot a birds eye view of one program&#39;s requests</span>

<span class="sd">    Args:</span>
<span class="sd">        star_tracker (object): a object from the StarTracker class</span>
<span class="sd">        all_star_maps (array): all of the starmaps of requests in the program</span>
<span class="sd">        all_star_cols (array): the colors to plot each request on the birds eye</span>
<span class="sd">        all_star_nobs (array): the number of observations in each scheduled window</span>
<span class="sd">        program (str): the program code</span>
<span class="sd">        stars_in_program (array): the list of the stars within the program</span>
<span class="sd">        nonqueue (boolean): if True, plot the non-queue times on the birds eye view</span>
<span class="sd">    Returns:</span>
<span class="sd">        None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_star_maps</span><span class="p">)):</span>
        <span class="n">all_star_maps_transpose</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">all_star_maps</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
        <span class="c1"># col = all_star_cols[i]</span>
        <span class="n">col</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;rgb(</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">all_star_cols</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">255</span><span class="p">)</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">all_star_cols</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="mi">255</span><span class="p">)</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">all_star_cols</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="mi">255</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="n">nobscounter</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">all_star_nobs</span><span class="p">[</span><span class="n">i</span><span class="p">])]</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Heatmap</span><span class="p">(</span>
            <span class="n">z</span> <span class="o">=</span> <span class="n">all_star_maps_transpose</span><span class="p">,</span>
            <span class="n">colorscale</span><span class="o">=</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;rgba(0,0,0,0)&#39;</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="p">]],</span>
            <span class="c1"># colorscale=color_scales[col],</span>
            <span class="n">zmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">zmax</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">opacity</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
            <span class="n">showscale</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="n">stars_in_program</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
            <span class="n">text</span><span class="o">=</span><span class="n">nobscounter</span><span class="p">,</span>
            <span class="n">hovertemplate</span><span class="o">=</span><span class="s1">&#39;&lt;b&gt;&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">stars_in_program</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">+</span>
                <span class="s1">&#39;&lt;/b&gt;&lt;br&gt;&lt;b&gt;Date: %</span><span class="si">{x}</span><span class="s1">&lt;/b&gt;&lt;br&gt;&lt;b&gt;Slot: %</span><span class="si">{y}</span><span class="s1">&lt;/b&gt;&lt;br&gt;Forecasted N_Obs: &#39;</span> <span class="o">+</span> \
                <span class="n">nobscounter</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;&lt;extra&gt;&lt;/extra&gt;&#39;</span><span class="p">,</span>
            <span class="n">showlegend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">))</span>
    <span class="k">if</span> <span class="n">nonqueue</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">star_tracker</span><span class="o">.</span><span class="n">nonqueue</span><span class="p">)):</span>
            <span class="n">starname</span> <span class="o">=</span> <span class="s1">&#39;RM__&#39;</span> <span class="o">+</span> <span class="n">star_tracker</span><span class="o">.</span><span class="n">nonqueue</span><span class="p">[</span><span class="s1">&#39;Starname&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
            <span class="n">starmap</span><span class="p">,</span> <span class="n">nobs</span> <span class="o">=</span> <span class="n">process_single_target_for_birds_eye</span><span class="p">(</span><span class="n">star_tracker</span><span class="p">,</span> <span class="n">starname</span><span class="p">)</span>
            <span class="n">starttime</span> <span class="o">=</span> <span class="n">Time</span><span class="p">(</span><span class="n">star_tracker</span><span class="o">.</span><span class="n">nonqueue</span><span class="p">[</span><span class="s1">&#39;Start&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
            <span class="n">stoptime</span> <span class="o">=</span> <span class="n">Time</span><span class="p">(</span><span class="n">star_tracker</span><span class="o">.</span><span class="n">nonqueue</span><span class="p">[</span><span class="s1">&#39;Stop&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>

            <span class="n">starmap_transpose</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">starmap</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Heatmap</span><span class="p">(</span>
                <span class="n">z</span> <span class="o">=</span> <span class="n">starmap_transpose</span><span class="p">,</span>
                <span class="n">colorscale</span><span class="o">=</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;rgba(0,0,0,0)&#39;</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;rgb(0, 0, 0)&#39;</span><span class="p">]],</span>
                <span class="n">zmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">zmax</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                <span class="n">opacity</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
                <span class="n">showscale</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">name</span><span class="o">=</span><span class="n">star_tracker</span><span class="o">.</span><span class="n">nonqueue</span><span class="p">[</span><span class="s1">&#39;Starname&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                <span class="n">text</span><span class="o">=</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">nobs</span><span class="p">)],</span>
                <span class="n">hovertemplate</span><span class="o">=</span><span class="s1">&#39;&lt;b&gt;&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">star_tracker</span><span class="o">.</span><span class="n">nonqueue</span><span class="p">[</span><span class="s1">&#39;Starname&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span> <span class="o">+</span>
                    <span class="s1">&#39;&lt;/b&gt;&lt;br&gt;&lt;b&gt;Date: %</span><span class="si">{x}</span><span class="s1">&lt;/b&gt;&lt;br&gt;&lt;b&gt;Slot: %</span><span class="si">{y}</span><span class="s1">&lt;/b&gt;&lt;br&gt;Window: &#39;</span> <span class="o">+</span> \
                    <span class="nb">str</span><span class="p">(</span><span class="n">starttime</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; to &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">stoptime</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;&lt;extra&gt;&lt;/extra&gt;&#39;</span><span class="p">,</span>
                <span class="n">showlegend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">))</span>
    <span class="n">labelsize2</span> <span class="o">=</span> <span class="mi">28</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Birds Eye View Semester Schedule&quot;</span><span class="p">,</span>
        <span class="n">yaxis_title</span><span class="o">=</span><span class="s2">&quot;Slot in Night&quot;</span><span class="p">,</span>
        <span class="n">xaxis_title</span><span class="o">=</span><span class="s2">&quot;Night in Semester&quot;</span><span class="p">,</span>
        <span class="n">xaxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
            <span class="n">title_font</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">labelsize2</span><span class="p">),</span>
            <span class="n">tickfont</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">labelsize2</span><span class="o">-</span><span class="mi">4</span><span class="p">),</span>
            <span class="n">tickvals</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">all_star_maps</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">14</span><span class="p">),</span>
        <span class="p">),</span>
        <span class="n">yaxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
            <span class="n">title_font</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">labelsize2</span><span class="p">),</span>
            <span class="n">tickfont</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">labelsize2</span><span class="o">-</span><span class="mi">4</span><span class="p">),</span>
            <span class="n">tickvals</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">all_star_maps</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">12</span><span class="p">),</span>
        <span class="p">),</span>
        <span class="c1"># yaxis=dict(),</span>
        <span class="c1"># xaxis=dict(),</span>
        <span class="n">template</span><span class="o">=</span><span class="s2">&quot;plotly&quot;</span><span class="p">,</span>
        <span class="n">showlegend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">admin_path</span> <span class="o">=</span> <span class="n">star_tracker</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">reports_directory</span> <span class="o">+</span> <span class="s2">&quot;admin/&quot;</span> <span class="o">+</span> <span class="n">star_tracker</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">current_day</span> <span class="o">+</span> <span class="s2">&quot;/birds_eyes/&quot;</span>
    <span class="n">fileout_path</span> <span class="o">=</span> <span class="n">star_tracker</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">reports_directory</span> <span class="o">+</span> <span class="n">program</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">star_tracker</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">current_day</span><span class="o">+</span> <span class="s2">&quot;/birds_eyes/&quot;</span>
    <span class="k">if</span> <span class="n">program</span> <span class="o">==</span> <span class="s1">&#39;admin&#39;</span><span class="p">:</span>
        <span class="n">fileout_name</span> <span class="o">=</span> <span class="s1">&#39;all_programs_birds_eyes.html&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fileout_name</span> <span class="o">=</span> <span class="n">program</span> <span class="o">+</span> <span class="s1">&#39;_birds_eyes.html&#39;</span>
        <span class="c1"># write copy to admin folder</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">write_html</span><span class="p">(</span><span class="n">admin_path</span> <span class="o">+</span> <span class="n">fileout_name</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">write_html</span><span class="p">(</span><span class="n">fileout_path</span> <span class="o">+</span> <span class="n">fileout_name</span><span class="p">)</span></div>


<div class="viewcode-block" id="generate_admin_view_plot_suite">
<a class="viewcode-back" href="../../kpfcc.html#kpfcc.plot.generate_admin_view_plot_suite">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">generate_admin_view_plot_suite</span><span class="p">(</span><span class="n">star_tracker</span><span class="p">,</span> <span class="n">set_of_program_cofs</span><span class="p">,</span> <span class="n">program_info</span><span class="p">,</span>
                                   <span class="n">all_program_first_forecasts</span><span class="p">,</span> <span class="n">all_star_maps_all_programs</span><span class="p">,</span>
                                   <span class="n">all_star_colors_all_programs</span><span class="p">,</span> <span class="n">all_star_nobs_all_programs</span><span class="p">,</span>
                                   <span class="n">all_stars_in_program</span><span class="p">,</span> <span class="n">prog_colors</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Construct all plots for admin view</span>

<span class="sd">    Args:</span>
<span class="sd">        star_tracker (object): a object from the StarTracker class</span>
<span class="sd">        set_of_program_cofs (array): each element is an array containing the cof of a program</span>
<span class="sd">        program_info (dict): keys are program codes and values are total obs for program</span>
<span class="sd">        all_program_first_forecasts (array): each element is an array containing the first forecast</span>
<span class="sd">                                            for the program, cof.</span>
<span class="sd">        all_star_maps_all_programs (array): all of the programmatic running total percentages</span>
<span class="sd">        all_star_colors_all_programs (array): the colors to plot each program on the birds eye</span>
<span class="sd">        all_star_nobs_all_programs (array): the number of observations in each scheduled window</span>
<span class="sd">        all_stars_in_program (array): the list of the stars within the program</span>
<span class="sd">    Returns:</span>
<span class="sd">        None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Building admin view of COFs.&quot;</span><span class="p">)</span>
    <span class="n">build_multi_request_cof</span><span class="p">(</span><span class="n">star_tracker</span><span class="p">,</span> <span class="n">set_of_program_cofs</span><span class="p">,</span> <span class="n">program_info</span><span class="p">,</span>
            <span class="n">all_first_forecasts</span><span class="o">=</span><span class="n">all_program_first_forecasts</span><span class="p">,</span> <span class="n">flag</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color_palette</span><span class="o">=</span><span class="n">prog_colors</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Building admin view of Birds Eye&quot;</span><span class="p">)</span>
    <span class="n">generate_birds_eye</span><span class="p">(</span><span class="n">star_tracker</span><span class="p">,</span> <span class="n">all_star_maps_all_programs</span><span class="p">,</span> <span class="n">all_star_colors_all_programs</span><span class="p">,</span>
            <span class="n">all_star_nobs_all_programs</span><span class="p">,</span> <span class="s1">&#39;admin&#39;</span><span class="p">,</span> <span class="n">all_stars_in_program</span><span class="p">,</span> <span class="n">nonqueue</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="generate_single_program_plot_suite">
<a class="viewcode-back" href="../../kpfcc.html#kpfcc.plot.generate_single_program_plot_suite">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">generate_single_program_plot_suite</span><span class="p">(</span><span class="n">star_tracker</span><span class="p">,</span> <span class="n">program_code</span><span class="p">,</span> <span class="n">build_cadence_plots</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot the birds eye view for the single program PI view</span>

<span class="sd">    Args:</span>
<span class="sd">        star_tracker (object): a object from the StarTracker class</span>
<span class="sd">        program_code (str): the program code</span>
<span class="sd">    Returns:</span>
<span class="sd">        program_cof_percent (array): the calculated cof array for each star in program</span>
<span class="sd">        total_program_requested_nobs (int): the total requested observations within the program</span>
<span class="sd">        program_first_forecast (array): the first forecast for each star in program</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">stars_completion</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">stars_in_program</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">stars_cofs_counters</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">stars_cofs_percents</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">stars_cofs_first_forecasts</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">stars_info</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Building individual program report for &quot;</span><span class="p">,</span> <span class="n">program_code</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">star_tracker</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">requests_frame</span><span class="p">[</span><span class="s1">&#39;Program_Code&#39;</span><span class="p">])):</span>
        <span class="k">if</span> <span class="n">star_tracker</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">requests_frame</span><span class="p">[</span><span class="s1">&#39;Program_Code&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">program_code</span><span class="p">:</span>
            <span class="n">star</span> <span class="o">=</span> <span class="n">star_tracker</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">requests_frame</span><span class="p">[</span><span class="s1">&#39;Starname&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">star_tracker</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">requests_frame</span><span class="p">[</span><span class="s1">&#39;# of Nights Per Semester&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">stars_in_program</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">star</span><span class="p">)</span>
                <span class="n">running_total_obs_counter</span><span class="p">,</span> <span class="n">running_total_obs_percent</span><span class="p">,</span> <span class="n">total_observations_requested</span><span class="p">,</span>\
                    <span class="n">first_forecast</span> <span class="o">=</span> <span class="n">single_request_cof</span><span class="p">(</span><span class="n">star_tracker</span><span class="p">,</span> <span class="n">star</span><span class="p">)</span>
                <span class="n">stars_completion</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">running_total_obs_percent</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">stars_cofs_counters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">running_total_obs_counter</span><span class="p">)</span>
                <span class="n">stars_cofs_percents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">running_total_obs_percent</span><span class="p">)</span>
                <span class="n">stars_cofs_first_forecasts</span><span class="p">[</span><span class="n">star</span><span class="p">]</span> <span class="o">=</span> <span class="n">first_forecast</span>
                <span class="n">stars_info</span><span class="p">[</span><span class="n">star</span><span class="p">]</span> <span class="o">=</span> <span class="n">total_observations_requested</span>
                <span class="k">if</span> <span class="n">build_cadence_plots</span><span class="p">:</span>
                    <span class="n">generate_cadence_view_plot</span><span class="p">(</span><span class="n">star_tracker</span><span class="p">,</span> <span class="n">program_code</span><span class="p">,</span> <span class="n">star</span><span class="p">)</span>
    <span class="n">total_program_requested_nobs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">stars_info</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
    <span class="n">program_cof_counter</span><span class="p">,</span> <span class="n">program_cof_percent</span> <span class="o">=</span> <span class="n">programmatic_cof</span><span class="p">(</span><span class="n">star_tracker</span><span class="p">,</span> <span class="n">stars_cofs_counters</span><span class="p">,</span>
        <span class="n">total_program_requested_nobs</span><span class="p">)</span>
    <span class="n">stars_cofs_counters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">program_cof_counter</span><span class="p">)</span>
    <span class="n">stars_cofs_percents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">program_cof_percent</span><span class="p">)</span>
    <span class="n">stars_info</span><span class="p">[</span><span class="n">program_code</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">stars_info</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
    <span class="n">program_first_forecast</span> <span class="o">=</span> <span class="n">star_tracker</span><span class="o">.</span><span class="n">get_star_first_forecast</span><span class="p">(</span><span class="n">program_code</span><span class="p">,</span> <span class="n">program_code</span><span class="p">)</span>
    <span class="n">stars_cofs_first_forecasts</span><span class="p">[</span><span class="n">program_code</span><span class="p">]</span> <span class="o">=</span> <span class="n">program_first_forecast</span>

    <span class="c1"># reverse ordering so the program code always appears at the top of the plotly figure</span>
    <span class="n">stars_cofs_counters</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
    <span class="n">stars_cofs_percents</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
    <span class="n">stars_info</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">stars_info</span><span class="o">.</span><span class="n">items</span><span class="p">())))</span>
    <span class="n">build_multi_request_cof</span><span class="p">(</span><span class="n">star_tracker</span><span class="p">,</span> <span class="n">stars_cofs_percents</span><span class="p">,</span> <span class="n">stars_info</span><span class="p">,</span>
        <span class="n">all_first_forecasts</span><span class="o">=</span><span class="n">stars_cofs_first_forecasts</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">program_cof_percent</span><span class="p">,</span> <span class="n">total_program_requested_nobs</span><span class="p">,</span> <span class="n">program_first_forecast</span><span class="p">,</span> \
            <span class="n">stars_in_program</span><span class="p">,</span> <span class="n">stars_completion</span></div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Jack Lubin.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>